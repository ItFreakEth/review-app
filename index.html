<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Global Irrigation Review App</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- ArcGIS JS API -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.29/"></script>

  <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="viewDiv"></div>

  <script>
    // üîÅ Fill these in:
    const WEBMAP_ID = "YOUR_WEBMAP_ID_HERE"; // <-- web map where US_binary is styled blue/yellow
    const BINARY_LAYER_ITEM_ID = "3ffec6629a8945d99fd46af2ce58e5b5"; // US_binary imagery
    const REVIEW_LAYER_ITEM_ID = "eedc0b4ec7364260a474f653127dc08f"; // AreaReview_Tags

    require([
      "esri/WebMap",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/widgets/Editor"
    ], function (WebMap, MapView, FeatureLayer, Editor) {

      // --- 1. Load the web map with the correct symbology ------------------

      const webmap = new WebMap({
        portalItem: {
          id: WEBMAP_ID
        }
      });

      const view = new MapView({
        container: "viewDiv",
        map: webmap
      });

      // --- 2. After the map loads, wire up layers + editor -----------------

      view.when().then(function () {

        // Try to find the binary layer in the webmap (by portal item id)
        const binaryLayer = webmap.layers.find(function (layer) {
          return layer.portalItem &&
                 layer.portalItem.id === BINARY_LAYER_ITEM_ID;
        });

        // Try to find the review layer in the webmap first
        let reviewLayer = webmap.layers.find(function (layer) {
          return layer.portalItem &&
                 layer.portalItem.id === REVIEW_LAYER_ITEM_ID;
        });

        // If review layer is not already in the webmap, add it from portal
        if (!reviewLayer) {
          reviewLayer = new FeatureLayer({
            portalItem: { id: REVIEW_LAYER_ITEM_ID },
            outFields: ["*"]
          });
          webmap.add(reviewLayer);
        } else {
          // make sure we can write to all fields
          reviewLayer.outFields = ["*"];
        }

        // Zoom to the binary raster extent if available
        if (binaryLayer) {
          binaryLayer.when(function () {
            if (binaryLayer.fullExtent) {
              view.goTo(binaryLayer.fullExtent.expand(1.1));
            }
          });
        }

        // --- 3. Editor widget for AreaReview_Tags -------------------------

        const editor = new Editor({
          view: view,
          layerInfos: [{
            layer: reviewLayer,
            addEnabled: true,
            updateEnabled: true,
            deleteEnabled: false   // reviewers can‚Äôt delete other tags
          }]
        });

        view.ui.add(editor, "top-right");
      });

    });
  </script>
</body>
</html>
